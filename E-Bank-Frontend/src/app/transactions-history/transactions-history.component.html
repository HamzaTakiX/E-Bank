<div class="container-fluid py-4 bg-light min-vh-100">
  <div class="mb-4">
    <h1 class="display-6 fw-bold">Transactions History</h1>
    <p class="text-muted">View all accounts transactions</p>
    <div class="d-flex justify-content-end mb-3">
      <button class="btn btn-outline-success me-2" (click)="exportToExcel()">
        <i class="bi bi-file-earmark-excel"></i> Export to Excel
      </button>
      <button class="btn btn-outline-info me-2" (click)="exportToCsv()">
        <i class="bi bi-file-earmark-arrow-down"></i> Export to CSV
      </button>
      <button class="btn btn-outline-danger" (click)="exportToPdf()">
        <i class="bi bi-file-earmark-pdf"></i> Export to PDF
      </button>
    </div>
  </div>

  <div class="card mb-4 bg-light">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-9">
          <div class="position-relative">
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (input)="filterTransactions()"
              placeholder="Search by account ID..."
              class="form-control ps-5"
            />
            <i class="bi bi-search position-absolute start-3 top-50 translate-middle-y text-muted"></i>
          </div>
        </div>

        <div class="row g-3">
          <!-- Existing Type Filter -->
          <div class="col-md-3">
            <select
              [(ngModel)]="selectedType"
              (change)="filterTransactions()"
              class="form-select"
            >
              <option value="">All Types</option>
              <option value="CREDIT">Credit</option>
              <option value="DEBIT">Debit</option>
            </select>
          </div>

          <!-- Date Filters -->
          <div class="col-md-3">
            <label for="fromDate" class="form-label">From Date</label>
            <input
              type="date"
              id="fromDate"
              [(ngModel)]="fromDate"
              (change)="filterTransactions()"
              class="form-control"
            />
          </div>
          <div class="col-md-3">
            <label for="toDate" class="form-label">To Date</label>
            <input
              type="date"
              id="toDate"
              [(ngModel)]="toDate"
              (change)="filterTransactions()"
              class="form-control"
            />
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="card shadow">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="bg-light">
            <tr>
              <th class="text-uppercase small fw-semibold text-muted px-3">Amount</th>
              <th class="text-uppercase small fw-semibold text-muted px-3">Operation ID</th>
              <th class="text-uppercase small fw-semibold text-muted px-3">Account ID</th>
              <th class="text-uppercase small fw-semibold text-muted px-3">Description</th>
              <th class="text-uppercase small fw-semibold text-muted px-3">Operation Date</th>
              <th class="text-uppercase small fw-semibold text-muted px-3">Type</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let transaction of filteredTransactions | paginate: { itemsPerPage: pageSize, currentPage: currentPage }"
              class="fade-in"
              [@fadeIn]
            >
              <td class="px-3 py-2 align-middle">
                <span [class]="transaction.type === 'CREDIT' ? 'text-success' : 'text-danger'">
                  {{transaction.type === 'CREDIT' ? '+' : '-'}}${{transaction.amount | number:'1.2-2'}}
                </span>
              </td>
              <td class="px-3 py-2 align-middle">{{transaction.id}}</td>
              <td class="px-3 py-2 align-middle">
                <p >{{transaction.customer.name}} - {{transaction.customer.email}}</p>
                <span class="text-primary">{{transaction.bank_account_id}} <a routerLink="/customer-accounts/{{transaction.id}}" >View Account</a></span>
              </td>
              <td class="px-3 py-2 align-middle">
                {{transaction.description || 'No description'}}
              </td>
              <td class="px-3 py-2 align-middle">{{transaction.operationDate | date:'medium'}}</td>
              <td class="px-3 py-2 align-middle">
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-success': transaction.type === 'CREDIT',
                    'bg-danger': transaction.type === 'DEBIT'
                  }"
                >
                  {{transaction.type}}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div>
      <label>Show
        <select [(ngModel)]="pageSize" (change)="onPageSizeChange(pageSize)">
          <option [value]="5">5</option>
          <option [value]="10" selected>10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
        entries
      </label>
    </div>
    <pagination-controls
      (pageChange)="onPageChange($event)"
      class="d-flex justify-content-center"
    ></pagination-controls>
  </div>
</div>
